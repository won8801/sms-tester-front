<<<<<<< HEAD
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>3ì‚¬ í…ŒìŠ¤íŠ¸ - ë©”ì‹œì§€ ì „ì†¡</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background-color: #f9f9f9;
    }
    .box {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    textarea, button {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .status {
      display: inline-block;
      padding: 0.3rem 0.6rem;
      margin-right: 0.5rem;
      border-radius: 5px;
      font-size: 0.95rem;
    }
    .success { background: #d4edda; color: #155724; }
    .fail { background: #f8d7da; color: #721c24; }
    .pending { background: #fff3cd; color: #856404; }

    #statusLine {
      font-weight: bold;
      white-space: nowrap;
      overflow-x: auto;
      margin: 1rem 0;
    }

    .log-entry {
      background: #f0f0f0;
      padding: 0.6rem;
      border-radius: 5px;
      font-size: 0.95rem;
      margin-top: 0.5rem;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>ğŸ“¨ ë©”ì‹œì§€ ì „ì†¡</h2>
    <p>ë‚¨ì€ í…ŒìŠ¤íŠ¸ íšŸìˆ˜: <strong id="remainingCount">ë¡œë”© ì¤‘...</strong></p>

    <textarea id="message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
    <button id="sendBtn" onclick="sendAll()">3ì‚¬ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œì†¡</button>

    <p id="statusLine">
      <span id="skStatus" class="status pending">SK: ëŒ€ê¸° ì¤‘</span>
      <span id="ktStatus" class="status pending">KT: ëŒ€ê¸° ì¤‘</span>
      <span id="lgStatus" class="status pending">LG: ëŒ€ê¸° ì¤‘</span>
    </p>

    <div id="logBox"></div>
    <button onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <script>
    const API_URL = "https://sms-backend-t9vy.onrender.com/api/send-sms";
    const APP_KEY = "JdkwtQ";
    const APP_SECRET = "txUzqH";
    const APP_CODE = "1000";

    const currentUser = JSON.parse(localStorage.getItem("loginUser") || "null");
    if (!currentUser) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      location.href = "login.html";
    }

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const userIndex = users.findIndex(u => u.id === currentUser.id);

    // ê´€ë¦¬ì ì„¤ì •ëœ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
    const phoneMap = JSON.parse(localStorage.getItem("phoneMap") || "{}");

    let currentLog = {
      time: "",
      results: {},
      message: ""
    };

    function logout() {
      localStorage.removeItem("loginUser");
      location.href = "login.html";
    }

    function updateRemainingDisplay() {
      const limit = users[userIndex].limit;
      document.getElementById("remainingCount").textContent = limit;
      document.getElementById("sendBtn").disabled = limit <= 0;
    }

    function updateStatus(carrier, result, msg) {
      const el = document.getElementById(`${carrier}Status`);
      el.textContent = `${carrier.toUpperCase()}: ${msg}`;
      el.className = `status ${result}`;
    }

    function appendCombinedLog(logObj) {
      const { time, results, message } = logObj;
      const resultText = ["sk", "kt", "lg"].map(c => `${c.toUpperCase()}: ${results[c] || "-"}`).join(" | ");
      const fullLine = `[${time}] ${resultText} - ${message}`;
      const logBox = document.getElementById("logBox");
      const log = document.createElement("div");
      log.className = "log-entry";
      log.textContent = fullLine;
      logBox.prepend(log);
    }

    function sendSMS(carrier, message) {
      const phoneNumber = phoneMap[carrier];
      if (!phoneNumber) {
        alert(`${carrier.toUpperCase()} ì „í™”ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        return Promise.resolve({ ok: false }); // ì‹¤íŒ¨ ì²˜ë¦¬
      }

      return fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          appkey: APP_KEY,
          appsecret: APP_SECRET,
          appcode: APP_CODE,
          to: phoneNumber,
          message
        })
      });
    }

    function sendAll() {
      const msg = document.getElementById("message").value.trim();
      if (!msg) return alert("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      if (users[userIndex].limit <= 0) {
        alert("ë‚¨ì€ í…ŒìŠ¤íŠ¸ íšŸìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      currentLog = {
        time: new Date().toLocaleTimeString(),
        results: {},
        message: msg
      };

      for (const carrier of ["sk", "kt", "lg"]) {
        updateStatus(carrier, "pending", "ì „ì†¡ ì¤‘...");
        sendSMS(carrier, msg)
          .then(res => {
            if (res && res.ok) {
              updateStatus(carrier, "success", "ì„±ê³µ");
              currentLog.results[carrier] = "ì„±ê³µ";
            } else {
              updateStatus(carrier, "fail", "ì‹¤íŒ¨");
              currentLog.results[carrier] = "ì‹¤íŒ¨";
            }
          })
          .catch(() => {
            updateStatus(carrier, "fail", "ì˜¤ë¥˜");
            currentLog.results[carrier] = "ì˜¤ë¥˜";
          })
          .finally(() => {
            if (Object.keys(currentLog.results).length === 3) {
              appendCombinedLog(currentLog);
            }
          });
      }

      // ì‚¬ìš© íšŸìˆ˜ ì°¨ê°
      users[userIndex].limit -= 1;
      localStorage.setItem("users", JSON.stringify(users));
      localStorage.setItem("loginUser", JSON.stringify(users[userIndex]));
      updateRemainingDisplay();
    }

    updateRemainingDisplay();
  </script>
</body>
</html>
=======
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>3ì‚¬ í…ŒìŠ¤íŠ¸ - ë©”ì‹œì§€ ì „ì†¡</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background-color: #f9f9f9;
    }
    .box {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    textarea, button {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .status {
      display: inline-block;
      padding: 0.3rem 0.6rem;
      margin-right: 0.5rem;
      border-radius: 5px;
      font-size: 0.95rem;
    }
    .success { background: #d4edda; color: #155724; }
    .fail { background: #f8d7da; color: #721c24; }
    .pending { background: #fff3cd; color: #856404; }

    #statusLine {
      font-weight: bold;
      white-space: nowrap;
      overflow-x: auto;
      margin: 1rem 0;
    }

    .log-entry {
      background: #f0f0f0;
      padding: 0.6rem;
      border-radius: 5px;
      font-size: 0.95rem;
      margin-top: 0.5rem;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>ğŸ“¨ ë©”ì‹œì§€ ì „ì†¡</h2>
    <p>ë‚¨ì€ í…ŒìŠ¤íŠ¸ íšŸìˆ˜: <strong id="remainingCount">ë¡œë”© ì¤‘...</strong></p>

    <textarea id="message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
    <button id="sendBtn" onclick="sendAll()">3ì‚¬ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œì†¡</button>

    <p id="statusLine">
      <span id="skStatus" class="status pending">SK: ëŒ€ê¸° ì¤‘</span>
      <span id="ktStatus" class="status pending">KT: ëŒ€ê¸° ì¤‘</span>
      <span id="lgStatus" class="status pending">LG: ëŒ€ê¸° ì¤‘</span>
    </p>

    <div id="logBox"></div>
    <button onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <script>
    const API_URL = "https://sms-backend-t9vy.onrender.com/api/send-sms";
    const APP_KEY = "JdkwtQ";
    const APP_SECRET = "txUzqH";
    const APP_CODE = "1000";

    const phoneMap = {
      sk: "01011112222",
      kt: "01033334444",
      lg: "01055556666"
    };

    const currentUser = JSON.parse(localStorage.getItem("loginUser") || "null");
    if (!currentUser) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      location.href = "login.html";
    }

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const userIndex = users.findIndex(u => u.id === currentUser.id);

    let currentLog = {
      time: "",
      results: {},
      message: ""
    };

    function logout() {
      localStorage.removeItem("loginUser");
      location.href = "login.html";
    }

    function updateRemainingDisplay() {
      const limit = users[userIndex].limit;
      document.getElementById("remainingCount").textContent = limit;
      document.getElementById("sendBtn").disabled = limit <= 0;
    }

    function updateStatus(carrier, result, msg) {
      const el = document.getElementById(`${carrier}Status`);
      el.textContent = `${carrier.toUpperCase()}: ${msg}`;
      el.className = `status ${result}`;
    }

    function appendCombinedLog(logObj) {
      const { time, results, message } = logObj;
      const resultText = ["sk", "kt", "lg"].map(c => `${c.toUpperCase()}: ${results[c] || "-"}`).join(" | ");
      const fullLine = `[${time}] ${resultText} - ${message}`;
      const logBox = document.getElementById("logBox");
      const log = document.createElement("div");
      log.className = "log-entry";
      log.textContent = fullLine;
      logBox.prepend(log);
    }

    function sendSMS(carrier, message) {
      return fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          appkey: APP_KEY,
          appsecret: APP_SECRET,
          appcode: APP_CODE,
          to: phoneMap[carrier],
          message
        })
      });
    }

    function sendAll() {
      const msg = document.getElementById("message").value.trim();
      if (!msg) return alert("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      if (users[userIndex].limit <= 0) {
        alert("ë‚¨ì€ í…ŒìŠ¤íŠ¸ íšŸìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      currentLog = {
        time: new Date().toLocaleTimeString(),
        results: {},
        message: msg
      };

      for (const carrier in phoneMap) {
        updateStatus(carrier, "pending", "ì „ì†¡ ì¤‘...");
        sendSMS(carrier, msg)
          .then(res => {
            if (res.ok) {
              updateStatus(carrier, "success", "ì„±ê³µ");
              currentLog.results[carrier] = "ì„±ê³µ";
            } else {
              updateStatus(carrier, "fail", "ì‹¤íŒ¨");
              currentLog.results[carrier] = "ì‹¤íŒ¨";
            }
          })
          .catch(() => {
            updateStatus(carrier, "fail", "ì˜¤ë¥˜");
            currentLog.results[carrier] = "ì˜¤ë¥˜";
          })
          .finally(() => {
            if (Object.keys(currentLog.results).length === 3) {
              appendCombinedLog(currentLog);
            }
          });
      }

      // ì‚¬ìš© íšŸìˆ˜ ì°¨ê°
      users[userIndex].limit -= 1;
      localStorage.setItem("users", JSON.stringify(users));
      localStorage.setItem("loginUser", JSON.stringify(users[userIndex]));
      updateRemainingDisplay();
    }

    updateRemainingDisplay();
  </script>
</body>
</html>
>>>>>>> 3d3603d4cf25ca2e16047129627d0e0b5ec795cf
